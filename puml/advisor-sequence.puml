@startuml

actor Advisor 
participant "CEP App Frontend" as Frontend
participant "CEP App Backend" as Backend
participant "Supabase Storage" as Storage
participant "AWS Lambda" as Lambda

== Classify client forms ==
Advisor -> Frontend: Download signed forms
Frontend -> Storage: Request from signed url
note right: Signed url is generated by backend, but for simplicity this sequence has been removed.
Storage -> Frontend: Client forms
Frontend -> Advisor: Client forms
Advisor -> Frontend: Classify forms with fund emails

== Verify client identification ==
Advisor -> Frontend: Download client identification
Frontend -> Storage: Request from signed url 
Storage -> Frontend: Client identification image
Frontend -> Advisor: Client identification image
Advisor -> Advisor: Verify (sign) client identification
Advisor -> Frontend: Upload verified identification
Frontend -> Storage: Upload verified identification via signed url

== Email Automation ==
Advisor -> Frontend: Trigger email automation
Frontend -> Backend: Trigger email automation
Backend -> Lambda: Post to AWS API Gateway (access_token, fund_emails, file_paths)
Lambda -> Storage: Request forms and verified id using file_paths
Storage -> Lambda: Client forms & verified id
Lambda -> Lambda: Structure email body
Lambda -> Lambda: Send emails to Funds via Microsoft Graph API

@enduml
